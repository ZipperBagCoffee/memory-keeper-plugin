# v6.5.0 Design: File References + Concept Tags

## Goal
facts.json에 파일 참조 추가 + 개념별 그룹화 인덱스

## Design

### 1. Session File Format Update

```markdown
## Decisions
- [architecture] Use React hooks: Better state management
  - files: src/hooks/useAuth.ts, src/components/Login.tsx
  - concepts: authentication, state-management

## Patterns
- [convention] Always test before commit
  - concepts: testing, workflow

## Issues
- [bugfix] Memory leak in dashboard: resolved
  - files: src/dashboard.ts
  - concepts: performance, react-hooks
```

### 2. facts.json Structure

```json
{
  "_meta": { "counter": 0, "lastSave": "..." },
  "decisions": [
    {
      "id": "d001",
      "type": "architecture",
      "date": "2025-12-21",
      "content": "Use React hooks",
      "reason": "Better state management",
      "files": ["src/hooks/useAuth.ts", "src/components/Login.tsx"],
      "concepts": ["authentication", "state-management"]
    }
  ],
  "patterns": [...],
  "issues": [...],
  "concepts": {
    "authentication": ["d001", "p003"],
    "state-management": ["d001", "d005"],
    "testing": ["p001", "p002"]
  }
}
```

### 3. Implementation Changes

**extractFacts() 변경:**
- 각 항목 아래 `- files:` 라인 파싱
- 각 항목 아래 `- concepts:` 라인 파싱
- concepts 인덱스 자동 업데이트

**add-* 명령 변경:**
```bash
node counter.js add-decision "content" "reason" "architecture" "file1,file2" "concept1,concept2"
```

**search 변경:**
```bash
node counter.js search --concept=authentication
node counter.js search --file=src/hooks
```

### 4. Parsing Rules

```
Line format:
- [type] Content: Reason
  - files: path1, path2
  - concepts: tag1, tag2

Regex for sub-items:
/^\s+-\s*(files|concepts):\s*(.+)$/i
```

## Backward Compatibility

- files/concepts 필드 없으면 빈 배열
- 기존 session.md 형식 계속 동작
- concepts 인덱스 없으면 자동 생성
