# v6.4.0 Design: Observation Types + Privacy Tags

## Goal
Add type classification to facts.json + filter sensitive information

## Design

### 1. Observation Types

Add `type` field while maintaining current structure:

```json
{
  "decisions": [
    {
      "id": "d001",
      "type": "architecture",
      "date": "2025-12-21",
      "content": "Use React hooks",
      "reason": "Better state management"
    }
  ],
  "patterns": [
    {
      "id": "p001",
      "type": "convention",
      "date": "2025-12-21",
      "content": "Always use TypeScript"
    }
  ],
  "issues": [
    {
      "id": "i001",
      "type": "bugfix",
      "date": "2025-12-21",
      "content": "Memory leak fixed",
      "status": "resolved"
    }
  ]
}
```

**Type Values:**
- decisions: `architecture`, `technology`, `approach`, `other`
- patterns: `convention`, `best-practice`, `anti-pattern`, `other`
- issues: `bugfix`, `performance`, `security`, `feature`, `other`

### 2. Session File Format Update

```markdown
## Decisions
- [architecture] Use React hooks: Better state management
- [technology] Use PostgreSQL: ACID compliance needed

## Patterns
- [convention] Always run tests before commit
- [best-practice] Use TypeScript for new files

## Issues
- [bugfix] Memory leak in dashboard: resolved
- [security] XSS vulnerability in form: open
```

### 3. Privacy Tags

Exclude `<private>` tag content from session files:

```markdown
## Decisions
- Use API key <private>sk-1234</private> for auth: Security
```

Extraction result:
```json
{
  "content": "Use API key [PRIVATE] for auth",
  "reason": "Security"
}
```

### 4. Implementation Changes

**counter.js changes:**

1. `addDecision(content, reason, type)` - add type parameter
2. `addPattern(content, type)` - add type parameter
3. `addIssue(content, status, type)` - add type parameter
4. `extractFacts()` - add type parsing + privacy filtering
5. `search()` - add type filter option

**Instructions changes:**

```markdown
## Decisions
- [architecture|technology|approach] Content: Reason

## Patterns
- [convention|best-practice] Pattern description

## Issues
- [bugfix|performance|security] Issue: open|resolved
```

## Backward Compatibility

- Default to `other` if `type` field is missing
- Continue to parse existing session.md format

## CLI Updates

```bash
# Search by type
node counter.js search --type=bugfix
node counter.js search --type=architecture

# Add with type specification
node counter.js add-decision "content" "reason" "architecture"
```
