# v6.4.0 Design: Observation Types + Privacy Tags

## Goal
facts.json에 타입 분류 추가 + 민감 정보 필터링

## Design

### 1. Observation Types

현재 구조 유지하면서 `type` 필드 추가:

```json
{
  "decisions": [
    {
      "id": "d001",
      "type": "architecture",
      "date": "2025-12-21",
      "content": "Use React hooks",
      "reason": "Better state management"
    }
  ],
  "patterns": [
    {
      "id": "p001",
      "type": "convention",
      "date": "2025-12-21",
      "content": "Always use TypeScript"
    }
  ],
  "issues": [
    {
      "id": "i001",
      "type": "bugfix",
      "date": "2025-12-21",
      "content": "Memory leak fixed",
      "status": "resolved"
    }
  ]
}
```

**Type Values:**
- decisions: `architecture`, `technology`, `approach`, `other`
- patterns: `convention`, `best-practice`, `anti-pattern`, `other`
- issues: `bugfix`, `performance`, `security`, `feature`, `other`

### 2. Session File Format Update

```markdown
## Decisions
- [architecture] Use React hooks: Better state management
- [technology] Use PostgreSQL: ACID compliance needed

## Patterns
- [convention] Always run tests before commit
- [best-practice] Use TypeScript for new files

## Issues
- [bugfix] Memory leak in dashboard: resolved
- [security] XSS vulnerability in form: open
```

### 3. Privacy Tags

Session file에서 `<private>` 태그 내용 제외:

```markdown
## Decisions
- Use API key <private>sk-1234</private> for auth: Security
```

추출 결과:
```json
{
  "content": "Use API key [PRIVATE] for auth",
  "reason": "Security"
}
```

### 4. Implementation Changes

**counter.js 변경:**

1. `addDecision(content, reason, type)` - type 파라미터 추가
2. `addPattern(content, type)` - type 파라미터 추가
3. `addIssue(content, status, type)` - type 파라미터 추가
4. `extractFacts()` - 타입 파싱 + privacy 필터링 추가
5. `search()` - 타입별 필터 옵션 추가

**Instructions 변경:**

```markdown
## Decisions
- [architecture|technology|approach] Content: Reason

## Patterns
- [convention|best-practice] Pattern description

## Issues
- [bugfix|performance|security] Issue: open|resolved
```

## Backward Compatibility

- `type` 필드 없으면 `other`로 기본값
- 기존 session.md 형식도 계속 파싱 가능

## CLI Updates

```bash
# 타입별 검색
node counter.js search --type=bugfix
node counter.js search --type=architecture

# 타입 지정 추가
node counter.js add-decision "content" "reason" "architecture"
```
