# v7.0.0 Design: Hierarchical Memory Structure

## Goal
단일 memory.md 대신 역할별 분리된 메모리 파일 구조

## Design

### 1. File Structure

```
.claude/memory/
├── memory.md          # Rolling session summaries (기존)
├── project.md         # 프로젝트 개요, 목표, 스택 (NEW)
├── architecture.md    # 아키텍처 결정 모음 (NEW)
├── conventions.md     # 코드 컨벤션, 스타일 (NEW)
├── facts.json
└── sessions/
```

### 2. File Purposes

| File | Purpose | When to Update |
|------|---------|---------------|
| `project.md` | 프로젝트 설명, 목표, 기술 스택 | 프로젝트 시작/변경시 |
| `architecture.md` | 아키텍처 결정, 구조 다이어그램 | 구조 변경시 |
| `conventions.md` | 코딩 스타일, 네이밍 규칙 | 규칙 추가시 |
| `memory.md` | 세션 요약 (rolling) | 매 세션 |

### 3. Load Order (SessionStart)

```javascript
// load-memory.js
1. project.md     (있으면)
2. architecture.md (있으면)
3. conventions.md  (있으면)
4. memory.md      (마지막 N줄)
5. facts.json summary
```

### 4. CLI Commands

```bash
# 특정 메모리 파일 편집
node counter.js memory-set project "This is a React app..."
node counter.js memory-set architecture "Uses MVC pattern..."
node counter.js memory-set conventions "Use camelCase for..."

# 메모리 파일 읽기
node counter.js memory-get project
node counter.js memory-get all

# 메모리 파일 목록
node counter.js memory-list
```

### 5. Template Files

**project.md:**
```markdown
# Project Overview

## Description
[What this project does]

## Tech Stack
- Framework:
- Language:
- Database:

## Goals
- [ ] Goal 1
- [ ] Goal 2
```

**architecture.md:**
```markdown
# Architecture

## Structure
[High-level architecture description]

## Key Components
- Component A: Purpose
- Component B: Purpose

## Data Flow
[How data moves through the system]
```

**conventions.md:**
```markdown
# Conventions

## Naming
- Variables: camelCase
- Components: PascalCase
- Files: kebab-case

## Patterns
- Always use TypeScript
- Prefer composition over inheritance
```

### 6. Implementation

**load-memory.js 변경:**
```javascript
function loadHierarchicalMemory() {
  const memoryDir = getProjectDir();
  const files = ['project.md', 'architecture.md', 'conventions.md'];
  let output = [];

  files.forEach(file => {
    const filePath = path.join(memoryDir, file);
    if (fs.existsSync(filePath)) {
      const content = fs.readFileSync(filePath, 'utf8');
      output.push(`## ${file}\n${content}`);
    }
  });

  // Add rolling memory (last 50 lines)
  const memoryPath = path.join(memoryDir, 'memory.md');
  if (fs.existsSync(memoryPath)) {
    const lines = fs.readFileSync(memoryPath, 'utf8').split('\n');
    const last50 = lines.slice(-50).join('\n');
    output.push(`## Recent Sessions\n${last50}`);
  }

  return output.join('\n\n---\n\n');
}
```

## Backward Compatibility

- 기존 memory.md 계속 동작
- 새 파일들은 선택적 (없으면 스킵)
- facts.json 변경 없음
