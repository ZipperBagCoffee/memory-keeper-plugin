# v7.0.0 Design: Hierarchical Memory Structure

## Goal
Role-separated memory file structure instead of single memory.md

## Design

### 1. File Structure

```
.claude/memory/
├── memory.md          # Rolling session summaries (existing)
├── project.md         # Project overview, goals, stack (NEW)
├── architecture.md    # Architecture decisions collection (NEW)
├── conventions.md     # Code conventions, style (NEW)
├── facts.json
└── sessions/
```

### 2. File Purposes

| File | Purpose | When to Update |
|------|---------|---------------|
| `project.md` | Project description, goals, tech stack | At project start/change |
| `architecture.md` | Architecture decisions, structure diagrams | On structure change |
| `conventions.md` | Coding style, naming rules | When rules are added |
| `memory.md` | Session summaries (rolling) | Every session |

### 3. Load Order (SessionStart)

```javascript
// load-memory.js
1. project.md     (if exists)
2. architecture.md (if exists)
3. conventions.md  (if exists)
4. memory.md      (last N lines)
5. facts.json summary
```

### 4. CLI Commands

```bash
# Edit specific memory file
node counter.js memory-set project "This is a React app..."
node counter.js memory-set architecture "Uses MVC pattern..."
node counter.js memory-set conventions "Use camelCase for..."

# Read memory files
node counter.js memory-get project
node counter.js memory-get all

# List memory files
node counter.js memory-list
```

### 5. Template Files

**project.md:**
```markdown
# Project Overview

## Description
[What this project does]

## Tech Stack
- Framework:
- Language:
- Database:

## Goals
- [ ] Goal 1
- [ ] Goal 2
```

**architecture.md:**
```markdown
# Architecture

## Structure
[High-level architecture description]

## Key Components
- Component A: Purpose
- Component B: Purpose

## Data Flow
[How data moves through the system]
```

**conventions.md:**
```markdown
# Conventions

## Naming
- Variables: camelCase
- Components: PascalCase
- Files: kebab-case

## Patterns
- Always use TypeScript
- Prefer composition over inheritance
```

### 6. Implementation

**load-memory.js changes:**
```javascript
function loadHierarchicalMemory() {
  const memoryDir = getProjectDir();
  const files = ['project.md', 'architecture.md', 'conventions.md'];
  let output = [];

  files.forEach(file => {
    const filePath = path.join(memoryDir, file);
    if (fs.existsSync(filePath)) {
      const content = fs.readFileSync(filePath, 'utf8');
      output.push(`## ${file}\n${content}`);
    }
  });

  // Add rolling memory (last 50 lines)
  const memoryPath = path.join(memoryDir, 'memory.md');
  if (fs.existsSync(memoryPath)) {
    const lines = fs.readFileSync(memoryPath, 'utf8').split('\n');
    const last50 = lines.slice(-50).join('\n');
    output.push(`## Recent Sessions\n${last50}`);
  }

  return output.join('\n\n---\n\n');
}
```

## Backward Compatibility

- Existing memory.md continues to work
- New files are optional (skip if not present)
- No changes to facts.json
